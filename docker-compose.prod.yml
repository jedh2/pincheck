# docker-compose.prod.ymp for EC2 production with HTTPS
version: '3.8'
services:
	app:
		build: .
		container_name: pincheck_app
		restart: always
		expose:
			- "5000"
		volumes:
			- ./app:/app
		environment:
			- FLASK_ENV=production

	nginx:
		image: nginx:latest
		container_name: nginx
		ports:
			- "80:80"
			- "443:443"
		volumes:
			- ./nginx/nginx.conf:/etc/nginx/conf.d/default.conf
			- ./certbot/www:/var/www/certbot
			- ./certbot/conf:/etc/letsencrypt
		depends_on:
			- app

	certbot:
		image: certbot/certbot
		container_name: certbot
		volumes:
			- ./certbot/www:/var/www/certbot
			- ./certbot/conf:/etc/letsencrypt
		entrypoint: >
			sh -c "certbot certonly --webroot --webroot-path=/var/www/certbot \
			--email your@email.com --agree-tos --no-eff-email \
			-d yourdomain.com -d www.yourdomain.com"